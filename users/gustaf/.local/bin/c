#!/bin/bash

# Default if C_DIRS not set
if [ -z "$C_DIRS" ]; then
    C_DIRS="$PWD:1"
fi

# Build find commands
cmd=""
IFS=',' read -ra PAIRS <<< "$C_DIRS"
for pair in "${PAIRS[@]}"; do
    IFS=':' read -r dir depth <<< "$pair"
    dir="${dir// /}"  # Remove spaces
    dir="${dir/#\~/$HOME}"  # Expand ~
    if [ -z "$cmd" ]; then
        cmd="find $dir -maxdepth $depth -type d"
    else
        cmd="$cmd; find $dir -maxdepth $depth -type d"
    fi
done

directory="$(eval "$cmd" | sort -u | fzf)"
if [[ $? -ne 0 ]]; then
    exit
fi
if [[ ! -z "$directory" ]]; then
    cd "$directory"
    exec $SHELL
fi
